/**
 * @ag-grid-community/infinite-row-model - Advanced Data Grid / Data Table supporting Javascript / React / AngularJS / Web Components * @version v26.0.0
 * @link http://www.ag-grid.com/
' * @license MIT
 */

/**
 * @ag-grid-community/infinite-row-model - Advanced Data Grid / Data Table supporting Javascript / React / AngularJS / Web Components * @version v26.0.0
 * @link http://www.ag-grid.com/
' * @license MIT
 */
import{_ as t,RowNode as e,PostConstruct as o,PreDestroy as r,RowNodeBlock as n,NumberSequence as i,Events as s,Autowired as a,Qualifier as c,BeanStub as h,Constants as p,Bean as u,ModuleNames as d}from"@ag-grid-community/core";var f,l=(f=function(t,e){return(f=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}f(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),w=function(t,e,o,r){var n,i=arguments.length,s=i<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,o):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,o,r);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(s=(i<3?n(s):i>3?n(e,o,s):n(e,o))||s);return i>3&&s&&Object.defineProperty(e,o,s),s},g=function(n){function i(t,e,o){var r=n.call(this,t)||this;return r.parentCache=e,r.params=o,r.startRow=t*o.blockSize,r.endRow=r.startRow+o.blockSize,r}return l(i,n),i.prototype.postConstruct=function(){this.createRowNodes()},i.prototype.getBlockStateJson=function(){return{id:""+this.getId(),state:{blockNumber:this.getId(),startRow:this.getStartRow(),endRow:this.getEndRow(),pageStatus:this.getState()}}},i.prototype.setDataAndId=function(e,o,r){t.exists(o)?e.setDataAndId(o,r.toString()):e.setDataAndId(void 0,void 0)},i.prototype.loadFromDatasource=function(){var e=this,o=this.createLoadParams();t.missing(this.params.datasource.getRows)?console.warn("AG Grid: datasource is missing getRows method"):window.setTimeout((function(){e.params.datasource.getRows(o)}),0)},i.prototype.processServerFail=function(){},i.prototype.createLoadParams=function(){return{startRow:this.getStartRow(),endRow:this.getEndRow(),successCallback:this.pageLoaded.bind(this,this.getVersion()),failCallback:this.pageLoadFailed.bind(this,this.getVersion()),sortModel:this.params.sortModel,filterModel:this.params.filterModel,context:this.gridOptionsWrapper.getContext()}},i.prototype.forEachNode=function(t,e,o){var r=this;this.rowNodes.forEach((function(n,i){r.startRow+i<o&&t(n,e.next())}))},i.prototype.getLastAccessed=function(){return this.lastAccessed},i.prototype.getRow=function(t,e){void 0===e&&(e=!1),e||(this.lastAccessed=this.params.lastAccessedSequence.next());var o=t-this.startRow;return this.rowNodes[o]},i.prototype.getStartRow=function(){return this.startRow},i.prototype.getEndRow=function(){return this.endRow},i.prototype.createRowNodes=function(){this.rowNodes=[];for(var t=0;t<this.params.blockSize;t++){var o=this.startRow+t,r=this.getContext().createBean(new e);r.setRowHeight(this.params.rowHeight),r.uiLevel=0,r.setRowIndex(o),r.setRowTop(this.params.rowHeight*o),this.rowNodes.push(r)}},i.prototype.processServerResult=function(t){var e=this;this.rowNodes.forEach((function(o,r){var n=t.rowData?t.rowData[r]:void 0;e.setDataAndId(o,n,e.startRow+r)}));var o=null!=t.rowCount&&t.rowCount>=0?t.rowCount:void 0;this.parentCache.pageLoaded(this,o)},i.prototype.destroyRowNodes=function(){this.rowNodes.forEach((function(t){t.clearRowTopAndRowIndex()}))},w([o],i.prototype,"postConstruct",null),w([r],i.prototype,"destroyRowNodes",null),i}(n),y=function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o])})(e,o)};return function(e,o){function r(){this.constructor=e}t(e,o),e.prototype=null===o?Object.create(o):(r.prototype=o.prototype,new r)}}(),C=function(t,e,o,r){var n,i=arguments.length,s=i<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,o):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,o,r);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(s=(i<3?n(s):i>3?n(e,o,s):n(e,o))||s);return i>3&&s&&Object.defineProperty(e,o,s),s},R=function(t,e){return function(o,r){e(o,r,t)}},v=function(e){function o(t){var o=e.call(this)||this;return o.lastRowIndexKnown=!1,o.blocks={},o.blockCount=0,o.rowCount=t.initialRowCount,o.params=t,o}return y(o,e),o.prototype.setBeans=function(t){this.logger=t.create("InfiniteCache")},o.prototype.getRow=function(t,e){void 0===e&&(e=!1);var o=Math.floor(t/this.params.blockSize),r=this.blocks[o];if(!r){if(e)return;r=this.createBlock(o)}return r.getRow(t)},o.prototype.createBlock=function(t){var e=this.createBean(new g(t,this,this.params));return this.blocks[e.getId()]=e,this.blockCount++,this.purgeBlocksIfNeeded(e),this.params.rowNodeBlockLoader.addBlock(e),e},o.prototype.refreshCache=function(){0==this.blockCount?this.purgeCache():(this.getBlocksInOrder().forEach((function(t){return t.setStateWaitingToLoad()})),this.params.rowNodeBlockLoader.checkBlockToLoad())},o.prototype.destroyAllBlocks=function(){var t=this;this.getBlocksInOrder().forEach((function(e){return t.destroyBlock(e)}))},o.prototype.getRowCount=function(){return this.rowCount},o.prototype.isLastRowIndexKnown=function(){return this.lastRowIndexKnown},o.prototype.pageLoaded=function(t,e){this.isAlive()&&(this.logger.log("onPageLoaded: page = "+t.getId()+", lastRow = "+e),this.checkRowCount(t,e),this.onCacheUpdated())},o.prototype.purgeBlocksIfNeeded=function(t){var e=this,r=this.getBlocksInOrder().filter((function(e){return e!=t}));r.sort((function(t,e){return e.getLastAccessed()-t.getLastAccessed()}));var n=this.params.maxBlocksInCache>0,i=n?this.params.maxBlocksInCache-1:null,s=o.MAX_EMPTY_BLOCKS_TO_KEEP-1;r.forEach((function(t,o){if(t.getState()===g.STATE_WAITING_TO_LOAD&&o>=s||!!n&&o>=i){if(e.isBlockCurrentlyDisplayed(t))return;if(e.isBlockFocused(t))return;e.removeBlockFromCache(t)}}))},o.prototype.isBlockFocused=function(t){var e=this.focusService.getFocusCellToUseAfterRefresh();if(!e)return!1;if(null!=e.rowPinned)return!1;var o=t.getStartRow(),r=t.getEndRow();return e.rowIndex>=o&&e.rowIndex<r},o.prototype.isBlockCurrentlyDisplayed=function(t){var e=t.getStartRow(),o=t.getEndRow()-1;return this.rowRenderer.isRangeInRenderedViewport(e,o)},o.prototype.removeBlockFromCache=function(t){t&&this.destroyBlock(t)},o.prototype.checkRowCount=function(t,e){if("number"==typeof e&&e>=0)this.rowCount=e,this.lastRowIndexKnown=!0;else if(!this.lastRowIndexKnown){var o=(t.getId()+1)*this.params.blockSize+this.params.overflowSize;this.rowCount<o&&(this.rowCount=o)}},o.prototype.setRowCount=function(e,o){this.rowCount=e,t.exists(o)&&(this.lastRowIndexKnown=o),this.lastRowIndexKnown||this.rowCount%this.params.blockSize==0&&this.rowCount++,this.onCacheUpdated()},o.prototype.forEachNodeDeep=function(t){var e=this,o=new i;this.getBlocksInOrder().forEach((function(r){return r.forEachNode(t,o,e.rowCount)}))},o.prototype.getBlocksInOrder=function(){return t.getAllValuesInObject(this.blocks).sort((function(t,e){return t.getId()-e.getId()}))},o.prototype.destroyBlock=function(t){delete this.blocks[t.getId()],this.destroyBean(t),this.blockCount--,this.params.rowNodeBlockLoader.removeBlock(t)},o.prototype.onCacheUpdated=function(){if(this.isAlive()){this.destroyAllBlocksPastVirtualRowCount();var t={type:s.EVENT_STORE_UPDATED};this.eventService.dispatchEvent(t)}},o.prototype.destroyAllBlocksPastVirtualRowCount=function(){var t=this,e=[];this.getBlocksInOrder().forEach((function(o){o.getId()*t.params.blockSize>=t.rowCount&&e.push(o)})),e.length>0&&e.forEach((function(e){return t.destroyBlock(e)}))},o.prototype.purgeCache=function(){var t=this;this.getBlocksInOrder().forEach((function(e){return t.removeBlockFromCache(e)})),this.lastRowIndexKnown=!1,0===this.rowCount&&(this.rowCount=this.params.initialRowCount),this.onCacheUpdated()},o.prototype.getRowNodesInRange=function(e,o){var r=this,n=[],s=-1,a=!1,c=new i;t.missing(e)&&(a=!0);var h=!1;return this.getBlocksInOrder().forEach((function(t){h||(a&&s+1!==t.getId()?h=!0:(s=t.getId(),t.forEachNode((function(t){var r=t===e||t===o;(a||r)&&n.push(t),r&&(a=!a)}),c,r.rowCount)))})),h||a?[]:n},o.MAX_EMPTY_BLOCKS_TO_KEEP=2,C([a("rowRenderer")],o.prototype,"rowRenderer",void 0),C([a("focusService")],o.prototype,"focusService",void 0),C([R(0,c("loggerFactory"))],o.prototype,"setBeans",null),C([r],o.prototype,"destroyAllBlocks",null),o}(h),I=function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o])})(e,o)};return function(e,o){function r(){this.constructor=e}t(e,o),e.prototype=null===o?Object.create(o):(r.prototype=o.prototype,new r)}}(),E=function(t,e,o,r){var n,i=arguments.length,s=i<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,o):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,o,r);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(s=(i<3?n(s):i>3?n(e,o,s):n(e,o))||s);return i>3&&s&&Object.defineProperty(e,o,s),s},k=function(e){function n(){return null!==e&&e.apply(this,arguments)||this}return I(n,e),n.prototype.getRowBounds=function(t){return{rowHeight:this.rowHeight,rowTop:this.rowHeight*t}},n.prototype.ensureRowHeightsValid=function(t,e,o,r){return!1},n.prototype.init=function(){var t=this;this.gridOptionsWrapper.isRowModelInfinite()&&(this.rowHeight=this.gridOptionsWrapper.getRowHeightAsNumber(),this.addEventListeners(),this.addDestroyFunc((function(){return t.destroyCache()})),this.verifyProps())},n.prototype.verifyProps=function(){if(null!=this.gridOptionsWrapper.getDefaultGroupOrderComparator()){t.doOnce((function(){return console.warn("AG Grid: defaultGroupOrderComparator cannot be used with Infinite Row Model. If using Infinite Row Model, then sorting is done on the server side, nothing to do with the client.")}),"IRM.DefaultGroupOrderComparator")}},n.prototype.start=function(){this.setDatasource(this.gridOptionsWrapper.getDatasource())},n.prototype.destroyDatasource=function(){this.datasource&&(this.getContext().destroyBean(this.datasource),this.rowRenderer.datasourceChanged(),this.datasource=null)},n.prototype.addEventListeners=function(){this.addManagedListener(this.eventService,s.EVENT_FILTER_CHANGED,this.onFilterChanged.bind(this)),this.addManagedListener(this.eventService,s.EVENT_SORT_CHANGED,this.onSortChanged.bind(this)),this.addManagedListener(this.eventService,s.EVENT_NEW_COLUMNS_LOADED,this.onColumnEverything.bind(this)),this.addManagedListener(this.eventService,s.EVENT_STORE_UPDATED,this.onCacheUpdated.bind(this))},n.prototype.onFilterChanged=function(){this.reset()},n.prototype.onSortChanged=function(){this.reset()},n.prototype.onColumnEverything=function(){(!this.cacheParams||this.isSortModelDifferent())&&this.reset()},n.prototype.isSortModelDifferent=function(){return!t.jsonEquals(this.cacheParams.sortModel,this.sortController.getSortModel())},n.prototype.getType=function(){return p.ROW_MODEL_TYPE_INFINITE},n.prototype.setDatasource=function(t){this.destroyDatasource(),this.datasource=t,t&&this.reset()},n.prototype.isEmpty=function(){return!this.infiniteCache},n.prototype.isRowsToRender=function(){return!!this.infiniteCache},n.prototype.getNodesInRangeForSelection=function(t,e){return this.infiniteCache?this.infiniteCache.getRowNodesInRange(t,e):[]},n.prototype.reset=function(){if(this.datasource){t.exists(this.gridOptionsWrapper.getRowNodeIdFunc())||this.selectionService.reset(),this.resetCache();var e=this.createModelUpdatedEvent();this.eventService.dispatchEvent(e)}},n.prototype.createModelUpdatedEvent=function(){return{type:s.EVENT_MODEL_UPDATED,api:this.gridApi,columnApi:this.columnApi,newPage:!1,newData:!1,keepRenderedRows:!0,animate:!1}},n.prototype.resetCache=function(){this.destroyCache();var t=this.gridOptionsWrapper.getMaxConcurrentDatasourceRequests();this.cacheParams={datasource:this.datasource,filterModel:this.filterManager.getFilterModel(),sortModel:this.sortController.getSortModel(),rowNodeBlockLoader:this.rowNodeBlockLoader,maxConcurrentRequests:this.defaultIfInvalid(t,2),initialRowCount:this.defaultIfInvalid(this.gridOptionsWrapper.getInfiniteInitialRowCount(),1),maxBlocksInCache:this.gridOptionsWrapper.getMaxBlocksInCache(),rowHeight:this.gridOptionsWrapper.getRowHeightAsNumber(),overflowSize:this.defaultIfInvalid(this.gridOptionsWrapper.getCacheOverflowSize(),1),blockSize:this.defaultIfInvalid(this.gridOptionsWrapper.getCacheBlockSize(),100),lastAccessedSequence:new i},this.infiniteCache=this.createBean(new v(this.cacheParams))},n.prototype.defaultIfInvalid=function(t,e){return t>0?t:e},n.prototype.destroyCache=function(){this.infiniteCache&&(this.infiniteCache=this.destroyBean(this.infiniteCache))},n.prototype.onCacheUpdated=function(){var t=this.createModelUpdatedEvent();this.eventService.dispatchEvent(t)},n.prototype.getRow=function(t){if(this.infiniteCache&&!(t>=this.infiniteCache.getRowCount()))return this.infiniteCache.getRow(t)},n.prototype.getRowNode=function(t){var e=void 0;return this.forEachNode((function(o){o.id===t&&(e=o)})),e},n.prototype.forEachNode=function(t){this.infiniteCache&&this.infiniteCache.forEachNodeDeep(t)},n.prototype.getTopLevelRowCount=function(){return this.getRowCount()},n.prototype.getTopLevelRowDisplayedIndex=function(t){return t},n.prototype.getRowIndexAtPixel=function(t){if(0!==this.rowHeight){var e=Math.floor(t/this.rowHeight),o=this.getRowCount()-1;return e>o?o:e}return 0},n.prototype.getRowCount=function(){return this.infiniteCache?this.infiniteCache.getRowCount():0},n.prototype.isRowPresent=function(t){return!!this.getRowNode(t.id)},n.prototype.refreshCache=function(){this.infiniteCache&&this.infiniteCache.refreshCache()},n.prototype.purgeCache=function(){this.infiniteCache&&this.infiniteCache.purgeCache()},n.prototype.isLastRowIndexKnown=function(){return!!this.infiniteCache&&this.infiniteCache.isLastRowIndexKnown()},n.prototype.setRowCount=function(t,e){this.infiniteCache&&this.infiniteCache.setRowCount(t,e)},E([a("filterManager")],n.prototype,"filterManager",void 0),E([a("sortController")],n.prototype,"sortController",void 0),E([a("selectionService")],n.prototype,"selectionService",void 0),E([a("gridApi")],n.prototype,"gridApi",void 0),E([a("columnApi")],n.prototype,"columnApi",void 0),E([a("rowRenderer")],n.prototype,"rowRenderer",void 0),E([a("rowNodeBlockLoader")],n.prototype,"rowNodeBlockLoader",void 0),E([o],n.prototype,"init",null),E([r],n.prototype,"destroyDatasource",null),n=E([u("rowModel")],n)}(h),m={moduleName:d.InfiniteRowModelModule,rowModels:{infinite:k}};export{m as InfiniteRowModelModule};